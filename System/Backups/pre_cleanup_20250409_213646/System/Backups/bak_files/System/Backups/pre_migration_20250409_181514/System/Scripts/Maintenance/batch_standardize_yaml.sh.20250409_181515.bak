#!/bin/bash

# Batch YAML Frontmatter Standardization Script
# This script standardizes YAML frontmatter for multiple files matching a pattern
# Usage: ./batch_standardize_yaml.sh <directory_pattern>
# Example: ./batch_standardize_yaml.sh "02-interviews/players"

if [ $# -ne 1 ]; then
  echo "Usage: $0 <directory_pattern>"
  echo "Example: $0 \"02-interviews/players\""
  exit 1
fi

DIRECTORY_PATTERN="$1"
VAULT_PATH="/Users/patricksmith/obsidian/acupcakeshop"
FULL_PATH="$VAULT_PATH/Athlete Financial Empowerment/$DIRECTORY_PATTERN"
STANDARDIZE_SCRIPT="$VAULT_PATH/standardize_yaml.sh"

# Ensure standardize_yaml.sh exists
if [ ! -f "$STANDARDIZE_SCRIPT" ]; then
  echo "Error: Standardization script not found: $STANDARDIZE_SCRIPT"
  exit 1
fi

# Find all markdown files in the specified directory pattern
echo "Finding markdown files in: $FULL_PATH"
FILES=$(find "$FULL_PATH" -name "*.md" -type f)

if [ -z "$FILES" ]; then
  echo "No markdown files found in: $FULL_PATH"
  exit 1
fi

# Count the number of files
FILE_COUNT=$(echo "$FILES" | wc -l)
echo "Found $FILE_COUNT markdown files to process."
echo

# Process each file
COUNTER=0
echo "$FILES" | while read -r file; do
  ((COUNTER++))
  echo "[$COUNTER/$FILE_COUNT] Processing: ${file#$VAULT_PATH/}"
  "$STANDARDIZE_SCRIPT" "$file"
  echo
done

echo "Completed YAML frontmatter standardization for $COUNTER files."